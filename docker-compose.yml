services:
  nn_laser_spot_tracking:
    build:
      context: .
      args:
        PYTORCH_INDEX_URL: https://download.pytorch.org/whl/cpu
        TORCH_VERSION: 2.0.1
        TORCHVISION_VERSION: 0.15.2
        TORCH_SUFFIX: +cpu
    network_mode: host
    privileged: true
    environment:
      - DISPLAY=$DISPLAY
      - QT_X11_NO_MITSHM=1
      - PYTHONUNBUFFERED=1
      - ROSCONSOLE_STDOUT_LINE_BUFFERED=1
      # Azure Kinect FPS: valid values are 5, 15, 30.
      - K4A_FPS=5
      # Azure Kinect color resolution: 720P, 1080P, 1440P, 1536P, 2160P, 3072P.
      - COLOR_RESOLUTION=720P
      # If true, any node exit will stop roslaunch (useful for production).
      - NODES_REQUIRED=true
      - TRACKING_ENABLE=false
      - HTTP_POSE_PATH=/camera_pose
      - HTTP_CALIBRATE_PATH=/calibrate
      - HTTP_PROJECTOR_CALIBRATION_PATH=/projector_calibration
      - PROJECTOR_CALIBRATION_PATH=/data/projector_calibration.json
    ports:
      - "5005:5005/udp"
    volumes:
      - /dev:/dev
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ./data:/data
    command:
      - bash
      - -lc
      - >-
        roslaunch nn_laser_spot_tracking docker_stack.launch
        log_level:=DEBUG
        tracking_enable:=$${TRACKING_ENABLE}
        k4a_fps:=$${K4A_FPS}
        color_resolution:=$${COLOR_RESOLUTION}
        nodes_required:=$${NODES_REQUIRED}
        http_pose_path:=$${HTTP_POSE_PATH}
        http_calibrate_path:=$${HTTP_CALIBRATE_PATH}
        http_projector_calibration_path:=$${HTTP_PROJECTOR_CALIBRATION_PATH}
        projector_calibration_path:=$${PROJECTOR_CALIBRATION_PATH}
